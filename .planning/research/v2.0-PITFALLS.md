# Pitfalls Research: v2.0 Shareable Presentations

**Domain:** Browser-based save/load, Multi-provider AI, GitHub Pages deployment
**Researched:** 2026-01-19
**Confidence:** HIGH (multiple authoritative sources verified)

## Executive Summary

The v2.0 milestone introduces four high-risk areas: browser file operations have memory limits and cross-browser quirks; multi-provider LLM APIs have inconsistent error formats requiring provider-specific handling; GitHub Pages deployment breaks SPAs without explicit base path configuration; and storing API keys in localStorage creates XSS vulnerabilities that cannot be fully mitigated in client-side apps. Non-technical teachers compound these risks since cryptic error messages cause abandonment. Each pitfall below includes warning signs, prevention strategies, and phase recommendations.

---

## File Operations Pitfalls

### Critical: Memory Exhaustion on Large Presentations

**What goes wrong:** When serializing large presentations (many slides with base64-encoded images) to JSON and creating Blobs, browsers run out of memory. Chrome limits single allocations to ~512MB. Firefox crashes around 400-500MB total tab memory. Safari caps Blob saves at 1GB.

**Why it happens:** Base64 encoding increases image size by ~33%. A 50-slide presentation with generated images can easily exceed 100MB as JSON. The entire payload must fit in memory simultaneously during `JSON.stringify()` -> `new Blob()` -> `URL.createObjectURL()`.

**Warning signs:**
- Browser tab becomes unresponsive during save
- "Out of memory" errors in console
- Save silently fails with no file downloaded

**Prevention:**
1. Compress images before base64 encoding (reduce quality to 70-80%)
2. Set maximum slide limit (e.g., 100 slides)
3. Show file size estimate before save, warn if > 50MB
4. For large presentations, offer streaming download via chunked approach

**Phase recommendation:** Address in Save/Load phase with size validation before save attempt.

---

### Moderate: Firefox Click Event Quirk

**What goes wrong:** Programmatic file downloads using `link.click()` fail silently in Firefox. The download anchor element needs a proper mouse event dispatched.

**Why it happens:** Firefox security model treats synthetic clicks differently from user-initiated clicks for download operations.

**Prevention:**
```typescript
// Instead of link.click(), use:
link.dispatchEvent(new MouseEvent('click', {
  bubbles: true,
  cancelable: true,
  view: window
}));
```

**Phase recommendation:** Implement correctly from start in Save/Load phase.

---

### Moderate: Object URL Memory Leaks

**What goes wrong:** Created object URLs (`URL.createObjectURL()`) persist until explicitly revoked, consuming memory indefinitely.

**Why it happens:** Developers forget to call `URL.revokeObjectURL()` after the download completes or component unmounts.

**Prevention:**
```typescript
const url = URL.createObjectURL(blob);
link.href = url;
link.click();
// Revoke after download initiates
setTimeout(() => URL.revokeObjectURL(url), 100);
```

**Phase recommendation:** Create utility function in Save/Load phase that handles cleanup automatically.

---

### Minor: Filename Sanitization

**What goes wrong:** User-provided presentation names containing special characters (`/`, `\`, `:`, `*`, etc.) cause save failures or security issues on different operating systems.

**Prevention:** Sanitize filenames before save:
```typescript
const sanitize = (name: string) => name.replace(/[/\\:*?"<>|]/g, '_');
```

**Phase recommendation:** Include in Save/Load validation.

---

## Multi-Provider API Pitfalls

### Critical: Rate Limit Error Format Inconsistency

**What goes wrong:** Different providers return 429 errors with different response formats, headers, and retry-after information. Code that works for OpenAI breaks for Anthropic.

**Provider differences:**

| Provider | Rate Limit Header | Retry-After Info | Error Format |
|----------|------------------|------------------|--------------|
| OpenAI | `x-ratelimit-*` | `retry-after` header | `{"error": {"type": "..."}}`  |
| Anthropic | `anthropic-ratelimit-*` | In error response | `{"type": "rate_limit_error"}` |
| Google | `retry-after` | Header or body | Varies by endpoint |

**Prevention:**
1. Create provider-specific error parsers
2. Normalize errors to common format before UI display
3. Implement exponential backoff with jitter for all providers
4. Add provider-specific retry delay extraction

**Phase recommendation:** Build abstraction layer in Multi-Provider API phase before adding providers.

---

### Critical: Quota vs Rate Limit Confusion

**What goes wrong:** 429 errors have two distinct causes: temporary rate limiting (wait and retry) vs. permanent quota exhaustion (cannot recover). Teams treat both the same, causing infinite retry loops or premature user errors.

**OpenAI specifics:**
- Rate limit: Exceeded RPM/TPM for tier (temporary)
- Quota exhaustion: `insufficient_quota` - billing issue (permanent)

**Warning signs:**
- Error message includes "insufficient_quota" or "billing"
- Retries never succeed despite backoff

**Prevention:**
1. Parse error type, not just status code
2. For quota errors: Show "check billing" message, don't retry
3. For rate limits: Implement exponential backoff (2s, 4s, 8s, max 30s)
4. Track retry count, give up after 3-5 attempts with user message

**Phase recommendation:** Core error handling in Multi-Provider API phase.

---

### Moderate: Invalid API Key Detection

**What goes wrong:** Users paste invalid/expired API keys, and the app fails cryptically on first actual API call rather than at configuration time.

**Why it happens:** No validation when key is saved to localStorage; errors only surface during generation.

**Prevention:**
1. Validate key format with regex before saving (OpenAI: `sk-...`, Anthropic: `sk-ant-...`)
2. Make test API call on key entry (e.g., OpenAI's `models.list()` is low-cost)
3. Store validation timestamp; re-validate periodically
4. Clear indication of which provider failed if multiple configured

**Test call examples:**
- OpenAI: `GET /v1/models` (free, just lists models)
- Anthropic: Small completion with `max_tokens: 1`
- Google: Already validated in current implementation

**Phase recommendation:** Add validation UI in Multi-Provider API phase during key configuration.

---

### Moderate: Organization/Project Removal (OpenAI)

**What goes wrong:** API key stops working with 401 error because user was removed from OpenAI organization, but the key wasn't deleted.

**Warning signs:** 401 with message about "organization membership"

**Prevention:**
1. Parse 401 error messages for organization issues
2. Show specific guidance: "Your OpenAI account may have been removed from an organization. Generate a new API key."
3. Offer quick link to OpenAI dashboard

**Phase recommendation:** Include in error message mapping during Multi-Provider API phase.

---

### Minor: Token-Based Rate Limits

**What goes wrong:** Apps track request counts but providers limit by tokens. Long-form content generation hits limits faster than expected.

**Prevention:**
1. Estimate token count before requests (~4 chars = 1 token rough estimate)
2. Display rate limit headers to users: "X tokens remaining this minute"
3. Consider token-aware queuing for batch operations

**Phase recommendation:** Nice-to-have for v2.0, can defer to v2.1.

---

## GitHub Pages Pitfalls

### Critical: Base Path Mismatch Breaks All Assets

**What goes wrong:** Deployed app shows blank page because all JavaScript, CSS, and asset URLs are absolute (`/assets/...`) but the app lives at `username.github.io/repo-name/`.

**Why it happens:** Vite defaults `base` to `/`. GitHub Pages project sites serve from `/repo-name/` subdirectory.

**Warning signs:**
- Blank white page after deploy
- Console shows 404 errors for JS/CSS files
- Assets reference `username.github.io/assets/` instead of `username.github.io/repo-name/assets/`

**Prevention:**

1. Set Vite base path in `vite.config.ts`:
```typescript
export default defineConfig({
  base: '/pipi/', // Match your repo name
  // ... other config
});
```

2. If using React Router (future), add basename:
```typescript
<BrowserRouter basename="/pipi">
```

3. Test production build locally with `vite preview`

**Phase recommendation:** Must configure in GitHub Pages deployment phase. Add to deployment checklist.

---

### Critical: SPA Routing 404s on Direct URL Access

**What goes wrong:** Users bookmark or share deep links (e.g., `/pipi/present`). Refreshing or direct access returns GitHub's 404 page because no `present/index.html` exists.

**Why it happens:** GitHub Pages is a static file server with no SPA routing support. It can only serve files that physically exist.

**Current impact:** PiPi uses state machine, not URL routing, so this is LOW risk for v2.0. Becomes critical if URL-based routing added later.

**Prevention options (if routing added):**
1. Hash routing (`/#/present`) - works out of box, ugly URLs
2. 404.html redirect hack - Create `404.html` that redirects to `index.html` with path preserved
3. Stay with state machine pattern - no URL routing, no problem

**Phase recommendation:** Document in deployment phase. If URL routing added in future, implement 404.html hack.

---

### Moderate: Stale Cache After Deploy

**What goes wrong:** Users see old version of app after deployment because browser/GitHub cached old files.

**Why it happens:** GitHub Pages caches static content up to 10 minutes. Browsers cache aggressively based on headers.

**Warning signs:**
- "I deployed but nothing changed"
- Works in incognito but not normal browsing
- Different users see different versions

**Prevention:**
1. Vite automatically adds content hashes to filenames (`index-abc123.js`)
2. Force rebuild with empty commit if urgent: `git commit --allow-empty -m "rebuild"`
3. Update `index.html` to prevent caching:
```html
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
```
4. Document: "Wait 10 minutes after deploy, or hard refresh (Ctrl+F5)"

**Phase recommendation:** Add cache-busting meta tags in deployment phase. Document in README.

---

### Minor: HTTPS Enforcement

**What goes wrong:** Mixed content warnings if any resources loaded over HTTP when page is HTTPS (all GitHub Pages).

**Current impact:** PiPi uses HTTPS CDNs, so LOW risk.

**Prevention:** Audit all CDN URLs use `https://`.

**Phase recommendation:** Verify during deployment phase.

---

## Security Pitfalls

### Critical: XSS Exposes All localStorage Data

**What goes wrong:** Any XSS vulnerability allows attackers to steal all API keys stored in localStorage. A single compromised dependency or user-input rendering bug exposes all keys.

**Why it happens:** localStorage has no access controls. Any JavaScript running on the page (including injected scripts) can read `localStorage.getItem('openai_key')`.

**Severity for PiPi:** HIGH - Teachers' personal API keys at risk. Keys can be used to run up bills.

**Warning signs:**
- Can't detect until keys are stolen
- Unexpected API usage/billing from providers

**Prevention (defense in depth):**
1. **Minimize XSS surface:** Sanitize all user content, use React's built-in XSS protection (no `dangerouslySetInnerHTML`)
2. **Content Security Policy:** Add strict CSP headers (difficult on GitHub Pages)
3. **Key rotation reminder:** Encourage users to regenerate keys periodically
4. **Clear key on logout/uninstall:** Provide "clear all data" button
5. **Warn users:** Display notice that keys are stored in browser, recommend creating dedicated API keys with spending limits

**What you cannot do:**
- Encrypt keys client-side (key for encryption also exposed to XSS)
- Use HttpOnly cookies (no backend)
- Move to server-side (violates client-only architecture)

**Phase recommendation:** Add security warning in Settings UI during Multi-Provider API phase. Document risk in user-facing help.

---

### Moderate: Keys Persist After "Logout"

**What goes wrong:** Users expect closing browser or clearing site data removes keys. But localStorage persists indefinitely unless explicitly cleared.

**Prevention:**
1. Add explicit "Remove all API keys" button in settings
2. Document that keys persist until manually removed
3. Consider sessionStorage for keys (cleared on tab close) - but requires re-entry each session

**Phase recommendation:** Add clear data button in Multi-Provider API phase.

---

### Moderate: Shared Computer Risk

**What goes wrong:** Teacher uses school computer, saves API key, another user accesses it later.

**Prevention:**
1. Warn on first key save: "Only save keys on your personal device"
2. Offer "don't save key" mode (enter each session)
3. Consider localStorage expiration (store timestamp, prompt for re-entry after 30 days)

**Phase recommendation:** Add warning modal in Multi-Provider API phase.

---

### Minor: Key Exposure in Error Messages

**What goes wrong:** API errors containing the key (e.g., "Invalid key: sk-abc...xyz") are logged to console or displayed to users.

**Prevention:**
1. Sanitize error messages before display
2. Never log raw API responses containing keys
3. Mask keys in any debug output: `sk-***xyz`

**Phase recommendation:** Include in error handling during Multi-Provider API phase.

---

## UX Pitfalls for Non-Technical Users

### Critical: Cryptic Error Messages Cause Abandonment

**What goes wrong:** Teachers see "Error 429" or "insufficient_quota" and have no idea what to do. They abandon the app.

**Why it happens:** Technical error messages passed directly from APIs to UI without translation.

**Prevention - Error Message Mapping:**

| Technical Error | User-Friendly Message | Action |
|-----------------|----------------------|--------|
| 401 Unauthorized | "Your API key isn't working. It may have expired or been entered incorrectly." | "Check your API key in Settings" button |
| 429 Rate Limit | "The AI service is busy. Please wait a moment." | Auto-retry with countdown |
| 429 Quota | "You've used all your API credits. Add credits in your OpenAI/Anthropic account." | Link to provider billing page |
| Network Error | "Can't connect to the internet. Check your connection and try again." | "Retry" button |
| Timeout | "This is taking longer than expected. Try with shorter content." | "Retry" button |

**Phase recommendation:** Build error message layer in Multi-Provider API phase. Every API call should translate errors.

---

### Moderate: No Feedback During API Key Validation

**What goes wrong:** User pastes API key, clicks save, nothing happens for 5 seconds during validation. User thinks app is broken, clicks again.

**Prevention:**
1. Show spinner immediately on save
2. Display validation progress: "Testing your API key..."
3. Green checkmark on success, red X with explanation on failure
4. Disable save button during validation

**Phase recommendation:** Include in Multi-Provider API key configuration UI.

---

### Moderate: Silent File Operation Failures

**What goes wrong:** Save/load fails silently. User thinks presentation saved, but it didn't.

**Prevention:**
1. Always show success confirmation: "Presentation saved as lesson.pipi"
2. For failures, show specific error: "File too large to save (152MB). Remove some slides and try again."
3. Use toast notifications that persist until dismissed
4. Show file size in save dialog

**Phase recommendation:** Add feedback UI in Save/Load phase.

---

### Minor: Confusing Provider Selection

**What goes wrong:** Multiple AI providers configured but user doesn't know which one is being used or why one was chosen over another.

**Prevention:**
1. Show active provider indicator: "Using: OpenAI GPT-4"
2. If provider switch happens (fallback), notify user
3. In settings, show provider status (configured/not configured, last validated)

**Phase recommendation:** Add provider indicator in Multi-Provider API phase.

---

## Phase-Specific Warning Summary

| Phase | Highest-Risk Pitfall | Mitigation Priority |
|-------|---------------------|---------------------|
| Save/Load | Memory exhaustion on large files | Size validation before save |
| Multi-Provider API | Rate limit format inconsistency | Provider-specific error parsers |
| Multi-Provider API | Invalid key detection | Test call on key entry |
| Multi-Provider API | XSS key exposure | Security warning + clear data button |
| GitHub Pages Deployment | Base path mismatch | Set Vite `base` config |
| All Phases | Cryptic errors for teachers | Error message translation layer |

---

## Sources

### File Operations
- [MDN Blob Documentation](https://developer.mozilla.org/en-US/docs/Web/API/Blob)
- [LogRocket: Programmatically Downloading Files](https://blog.logrocket.com/programmatically-downloading-files-browser/)
- [FileSaver.js Large File Issues](https://github.com/eligrey/FileSaver.js/issues/163)
- [JSON Performance Optimization](https://jsonconsole.com/blog/performance-optimization-large-json-datasets-techniques-strategies)

### Multi-Provider API
- [OpenAI Error Codes Documentation](https://platform.openai.com/docs/guides/error-codes)
- [OpenAI Help: 429 Errors](https://help.openai.com/en/articles/5955604-how-can-i-solve-429-too-many-requests-errors)
- [Anthropic Rate Limits Documentation](https://docs.anthropic.com/en/api/rate-limits)
- [Eden AI: Handling LLM Rate Limits](https://www.edenai.co/post/how-to-handle-rate-limits-for-llms-and-ai-apis)
- [Portkey: Tackling Rate Limiting](https://portkey.ai/blog/tackling-rate-limiting-for-llm-apps/)

### GitHub Pages
- [Vite Static Deploy Guide](https://vite.dev/guide/static-deploy)
- [GitHub Community: SPA Routing Discussion](https://github.com/orgs/community/discussions/64096)
- [spa-github-pages Workaround](https://github.com/rafgraph/spa-github-pages)
- [GitHub Community: Caching Discussion](https://github.com/orgs/community/discussions/11884)

### Security
- [Trevor Lasn: The Problem with localStorage](https://www.trevorlasn.com/blog/the-problem-with-local-storage)
- [OWASP HTML5 Security Cheat Sheet](https://cheatsheetseries.owasp.org/cheatsheets/HTML5_Security_Cheat_Sheet.html)
- [OpenAI API Key Safety Best Practices](https://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety)
- [Design Code Tips: localStorage XSS Vulnerabilities](https://design-code.tips/blog/2025-02-28-why-local-storage-is-vulnerable-to-xss-attacks-and-a-safer-alternative/)

### UX
- [NN/g Error Message Guidelines](https://www.nngroup.com/articles/error-message-guidelines/)
- [LogRocket: Error Message UX](https://blog.logrocket.com/ux-design/writing-clear-error-messages-ux-guidelines-examples/)
- [UX Collective: Designing API Error Codes](https://uxdesign.cc/documenting-api-error-codes-and-responses-135313b10af9)

---

*Pitfalls research: 2026-01-19*
