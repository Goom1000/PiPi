---
phase: 42-student-friendly-slides
plan: 02
type: execute
wave: 2
depends_on: [42-01]
files_modified:
  - services/geminiService.ts
  - services/providers/claudeProvider.ts
autonomous: true

must_haves:
  truths:
    - "User generates slides and sees conversational sentences directed at students"
    - "Bullet language complexity matches Year 6 level"
    - "Student-friendly style applies automatically to all new generations"
    - "Teleprompter (speakerNotes) remains teacher-facing"
  artifacts:
    - path: "services/geminiService.ts"
      provides: "Gemini slide generation with student-friendly rules"
      contains: "getStudentFriendlyRules"
    - path: "services/providers/claudeProvider.ts"
      provides: "Claude slide generation with student-friendly rules"
      contains: "getStudentFriendlyRules"
  key_links:
    - from: "services/geminiService.ts"
      to: "services/prompts/studentFriendlyRules.ts"
      via: "import"
      pattern: "import.*getStudentFriendlyRules"
    - from: "services/providers/claudeProvider.ts"
      to: "services/prompts/studentFriendlyRules.ts"
      via: "import"
      pattern: "import.*getStudentFriendlyRules"
    - from: "getSystemInstructionForMode"
      to: "studentFriendlyRules"
      via: "string concatenation"
      pattern: "\\$\\{studentFriendlyRules\\}"
---

<objective>
Apply student-friendly prompt rules to both AI providers for all slide generation modes.

Purpose: This plan integrates the shared student-friendly rules into Gemini and Claude providers so all generated slide content speaks directly to students. Also applies to variant slide types (Elaborate, Work Together, Class Challenge).

Output: Both providers produce student-facing bullet points while preserving teacher-facing teleprompter scripts.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/42-student-friendly-slides/42-CONTEXT.md
@.planning/phases/42-student-friendly-slides/42-RESEARCH.md
@.planning/phases/42-student-friendly-slides/42-01-SUMMARY.md
@services/prompts/studentFriendlyRules.ts
@services/geminiService.ts
@services/providers/claudeProvider.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Integrate student-friendly rules into Gemini provider</name>
  <files>services/geminiService.ts</files>
  <action>
1. Add import at top of file:
```typescript
import { getStudentFriendlyRules } from './prompts/studentFriendlyRules';
```

2. Modify `getSystemInstructionForMode` function (around line 99) to accept gradeLevel and inject student-friendly rules. Update signature:
```typescript
function getSystemInstructionForMode(
  mode: GenerationMode,
  verbosity: VerbosityLevel = 'standard',
  gradeLevel: string = 'Year 6 (10-11 years old)'
): string {
  const teleprompterRules = getTeleprompterRulesForVerbosity(verbosity);
  const studentFriendlyRules = getStudentFriendlyRules(gradeLevel);

  switch (mode) {
    case 'fresh':
      return `
You are an elite Primary Education Consultant.
Your goal is to transform a formal lesson plan into a teaching slideshow.

${studentFriendlyRules}

CRITICAL: You will be provided with both text AND visual images of the document.
...rest of existing prompt...

${teleprompterRules}

LAYOUTS: ...
`;
```

3. Insert `${studentFriendlyRules}` after the opening role description and BEFORE the CRITICAL rules for each mode (fresh, refine, blend). The student-friendly rules should come early in the prompt to establish the content style.

4. Update the call to `getSystemInstructionForMode` in `generateLessonSlides` (around line 183) to pass gradeLevel:
```typescript
const systemInstruction = getSystemInstructionForMode(input.mode, input.verbosity, input.gradeLevel);
```

5. Apply same pattern to variant slide generators. Update these functions to use student-friendly rules:

   - `generateElaborateSlide` (around line 545): Add gradeLevel parameter, inject rules into systemInstruction
   - `generateWorkTogetherSlide` (around line 607): Add gradeLevel parameter, inject rules into systemInstruction
   - `generateClassChallengeSlide` (around line 685): Add gradeLevel parameter, inject rules into systemInstruction

For variant slides, add after the "TASK:" line:
```typescript
const studentFriendlyRules = getStudentFriendlyRules('Year 6 (10-11 years old)');
```
And inject into systemInstruction after the topic intro.

NOTE: Variant slides don't receive GenerationInput, so use hardcoded default. They are always generated in context of an existing presentation.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Import present: `grep -n "getStudentFriendlyRules" services/geminiService.ts`
Rules injected in fresh mode: `grep -A5 "case 'fresh'" services/geminiService.ts | grep -q "studentFriendlyRules"`
  </verify>
  <done>
Gemini provider imports getStudentFriendlyRules, passes gradeLevel through getSystemInstructionForMode, and injects student-friendly rules into all generation modes (fresh, refine, blend) plus variant slides (elaborate, work-together, class-challenge).
  </done>
</task>

<task type="auto">
  <name>Task 2: Integrate student-friendly rules into Claude provider</name>
  <files>services/providers/claudeProvider.ts</files>
  <action>
1. Add import at top of file (adjust path for nested providers directory):
```typescript
import { getStudentFriendlyRules } from '../prompts/studentFriendlyRules';
```

2. Modify `getSystemPromptForMode` function (around line 199) to accept gradeLevel and inject student-friendly rules. Update signature:
```typescript
function getSystemPromptForMode(
  mode: GenerationMode,
  verbosity: VerbosityLevel = 'standard',
  gradeLevel: string = 'Year 6 (10-11 years old)'
): string {
  const teleprompterRules = getTeleprompterRulesForVerbosity(verbosity);
  const studentFriendlyRules = getStudentFriendlyRules(gradeLevel);

  switch (mode) {
    case 'fresh':
      return `
You are an elite Primary Education Consultant.
Your goal is to transform a formal lesson plan into a teaching slideshow.

${studentFriendlyRules}

CRITICAL: You will be provided with text content from the document.
...rest of existing prompt...

${teleprompterRules}

LAYOUTS: ...
`;
```

3. Insert `${studentFriendlyRules}` after the opening role description for each mode (fresh, refine, blend), same position as Gemini.

4. Update the call to `getSystemPromptForMode` in `generateLessonSlides` method (around line 418) to pass gradeLevel:
```typescript
const systemPrompt = getSystemPromptForMode(input.mode, input.verbosity, input.gradeLevel);
```

5. Apply same pattern to variant slide generators in ClaudeProvider class:

   - `generateElaborateSlide` (around line 643): Add gradeLevel, inject rules
   - `generateWorkTogetherSlide` (around line 700): Add gradeLevel, inject rules
   - `generateClassChallengeSlide` (around line 765): Add gradeLevel, inject rules

For variant slides, add:
```typescript
const studentFriendlyRules = getStudentFriendlyRules('Year 6 (10-11 years old)');
```
And inject into systemPrompt after the topic intro.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Import present: `grep -n "getStudentFriendlyRules" services/providers/claudeProvider.ts`
Rules injected: `grep -c "studentFriendlyRules" services/providers/claudeProvider.ts` returns > 0
  </verify>
  <done>
Claude provider imports getStudentFriendlyRules, passes gradeLevel through getSystemPromptForMode, and injects student-friendly rules into all generation modes plus variant slides.
  </done>
</task>

<task type="auto">
  <name>Task 3: Manual verification of generated content</name>
  <files>none</files>
  <action>
This is a verification-only task. The executor should:

1. Start the dev server: `npm run dev`
2. Open the app in browser
3. Upload a sample lesson PDF (or use an existing .cue file)
4. Generate slides using AI
5. Inspect the generated slide content to verify:
   - Bullet points are conversational sentences directed at students
   - No teacher-facing language like "Explain to students..." appears in bullet points
   - Teleprompter (speakerNotes) still contains teacher-facing guidance

If the app successfully generates slides with student-friendly content, the task is complete. If generation fails or content is still teacher-facing, debug and adjust the prompt injection.

Note: This task does not modify files - it validates the integration works end-to-end.
  </action>
  <verify>
App starts without errors: `npm run dev` serves successfully
Generated slides contain student-facing language (manual inspection)
Teleprompter contains teacher-facing language (manual inspection)
  </verify>
  <done>
App generates slides where bullet points speak directly to students while teleprompter maintains teacher-facing guidance. All three requirements (SLIDE-01, SLIDE-02, SLIDE-03) are satisfied.
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles: `npx tsc --noEmit` exits 0
2. Both providers import shared rules:
   - `grep "getStudentFriendlyRules" services/geminiService.ts`
   - `grep "getStudentFriendlyRules" services/providers/claudeProvider.ts`
3. App runs: `npm run dev` starts successfully
4. Manual test: Generate slides and verify student-facing content
</verification>

<success_criteria>
- [ ] services/geminiService.ts imports and uses getStudentFriendlyRules
- [ ] services/providers/claudeProvider.ts imports and uses getStudentFriendlyRules
- [ ] Both providers inject rules into all generation modes (fresh, refine, blend)
- [ ] Variant slides (elaborate, work-together, class-challenge) also use rules
- [ ] TypeScript compiles without errors
- [ ] Generated slide content is student-facing (manual verification)
- [ ] Teleprompter content is teacher-facing (manual verification)
</success_criteria>

<output>
After completion, create `.planning/phases/42-student-friendly-slides/42-02-SUMMARY.md`
</output>
