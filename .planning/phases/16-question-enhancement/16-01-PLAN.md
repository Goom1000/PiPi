---
phase: 16-question-enhancement
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - services/geminiService.ts
  - services/aiProvider.ts
  - services/providers/geminiProvider.ts
  - services/providers/claudeProvider.ts
autonomous: true

must_haves:
  truths:
    - "AI returns both question and answer in a single response"
    - "Answer contains **bold** markers for key points"
    - "Difficulty level affects question cognitive depth"
  artifacts:
    - path: "services/geminiService.ts"
      provides: "generateQuestionWithAnswer function"
      exports: ["generateQuestionWithAnswer", "QuestionWithAnswer"]
    - path: "services/aiProvider.ts"
      provides: "Updated interface with new method"
      contains: "generateQuestionWithAnswer"
    - path: "services/providers/geminiProvider.ts"
      provides: "Gemini implementation"
      contains: "generateQuestionWithAnswer"
    - path: "services/providers/claudeProvider.ts"
      provides: "Claude implementation"
      contains: "generateQuestionWithAnswer"
  key_links:
    - from: "services/providers/geminiProvider.ts"
      to: "services/geminiService.ts"
      via: "import and call"
      pattern: "geminiGenerateQuestionWithAnswer"
    - from: "services/geminiService.ts"
      to: "@google/genai"
      via: "structured output schema"
      pattern: "responseSchema.*question.*answer"
---

<objective>
Extend the AI service layer to generate questions with expected answers.

Purpose: Teachers need to see the expected answer in the teleprompter so they can recognize correct student responses. The current system only generates questions.

Output: New `generateQuestionWithAnswer` function that returns `{question: string, answer: string}` with Bloom's taxonomy-based difficulty mapping and bolded key points in the answer.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/16-question-enhancement/16-CONTEXT.md
@.planning/phases/16-question-enhancement/16-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create generateQuestionWithAnswer in geminiService.ts</name>
  <files>services/geminiService.ts</files>
  <action>
Add a new interface and function after the existing `generateQuickQuestion`:

1. Add interface (after QuizQuestion interface around line 467):
```typescript
export interface QuestionWithAnswer {
  question: string;
  answer: string;  // Markdown with **bold** for key points
}
```

2. Add new function `generateQuestionWithAnswer`:
- Parameters: `apiKey: string, slideTitle: string, slideContent: string[], difficulty: 'A' | 'B' | 'C' | 'D' | 'E'`
- Returns: `Promise<QuestionWithAnswer>`
- Model: `gemini-3-flash-preview` (same as existing quick question)
- Use structured JSON output with `responseSchema` (like existing quiz generation)

System instruction should include:
- Year 6 (10-11 year old) context
- Bloom's taxonomy difficulty mapping:
  - A: Analysis/Synthesis - "Why does X affect Y?", "What would happen if..."
  - B: Application - "How would you use...", "Explain how..."
  - C: Understanding - "Describe in your own words", "What does X mean?"
  - D: Comprehension - "Give an example of...", "Which one shows..."
  - E: Recall - "What is...", "Name the...", "List the..."
- Answer format rules:
  - Write a sample answer a good student would give
  - Use **bold** around KEY POINTS the teacher should listen for
  - Length: 1-2 sentences for Grade E/D, 2-3 sentences for C/B/A

Use `responseSchema` with:
```typescript
{
  type: Type.OBJECT,
  properties: {
    question: { type: Type.STRING },
    answer: { type: Type.STRING, description: "Sample answer with **key points** bolded" }
  },
  required: ['question', 'answer']
}
```

Error handling: Return fallback `{question: "Could not generate question", answer: "Please try again"}` on failure.
  </action>
  <verify>TypeScript compiles without errors: `cd "/Users/ricky/Documents/App_Projects/Education Apps/DEV - PiPi" && npx tsc --noEmit`</verify>
  <done>New `generateQuestionWithAnswer` function exported from geminiService.ts with structured JSON output</done>
</task>

<task type="auto">
  <name>Task 2: Update AIProviderInterface and implement in both providers</name>
  <files>services/aiProvider.ts, services/providers/geminiProvider.ts, services/providers/claudeProvider.ts</files>
  <action>
1. In `services/aiProvider.ts`:
   - Import `QuestionWithAnswer` from geminiService
   - Add method to `AIProviderInterface`:
   ```typescript
   generateQuestionWithAnswer(
     slideTitle: string,
     slideContent: string[],
     difficulty: 'A' | 'B' | 'C' | 'D' | 'E'
   ): Promise<QuestionWithAnswer>;
   ```

2. In `services/providers/geminiProvider.ts`:
   - Import `generateQuestionWithAnswer as geminiGenerateQuestionWithAnswer` from geminiService
   - Add implementation that wraps the service call:
   ```typescript
   async generateQuestionWithAnswer(
     slideTitle: string,
     slideContent: string[],
     difficulty: 'A' | 'B' | 'C' | 'D' | 'E'
   ): Promise<QuestionWithAnswer> {
     try {
       return await geminiGenerateQuestionWithAnswer(this.apiKey, slideTitle, slideContent, difficulty);
     } catch (error) {
       throw this.wrapError(error);
     }
   }
   ```

3. In `services/providers/claudeProvider.ts`:
   - Add same method signature
   - For Claude, implement using Anthropic's API with similar prompt structure
   - Parse Claude's response (which will be JSON text) into QuestionWithAnswer
   - Use similar system instruction and prompt pattern as Gemini version
  </action>
  <verify>
TypeScript compiles: `cd "/Users/ricky/Documents/App_Projects/Education Apps/DEV - PiPi" && npx tsc --noEmit`
Both providers implement the interface (no type errors)
  </verify>
  <done>
- AIProviderInterface includes generateQuestionWithAnswer method
- GeminiProvider wraps geminiService call
- ClaudeProvider has equivalent implementation
  </done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. New exports available: `QuestionWithAnswer`, `generateQuestionWithAnswer`
3. Both providers implement the new interface method
</verification>

<success_criteria>
1. `generateQuestionWithAnswer` returns `{question, answer}` with structured JSON
2. Answer includes **bold** markers for key points
3. Five difficulty levels (A/B/C/D/E) mapped to Bloom's taxonomy
4. Both Gemini and Claude providers implement the method
5. Existing `generateQuickQuestion` unchanged (backward compatible)
</success_criteria>

<output>
After completion, create `.planning/phases/16-question-enhancement/16-01-SUMMARY.md`
</output>
