---
phase: 03-disabled-ai-state
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - components/EnableAIModal.tsx
  - components/SettingsModal.tsx
  - App.tsx
autonomous: true

must_haves:
  truths:
    - "Clicking disabled AI feature shows friendly invitation modal"
    - "Modal has single 'Open Settings' button (no dismiss)"
    - "Settings auto-focuses API key input when opened from modal"
    - "Modal closes when Settings opens"
  artifacts:
    - path: "components/EnableAIModal.tsx"
      provides: "Friendly invitation modal for enabling AI features"
      exports: ["EnableAIModal"]
    - path: "components/SettingsModal.tsx"
      provides: "Auto-focus API key input via prop"
      exports: ["SettingsModal"]
    - path: "App.tsx"
      provides: "EnableAIModal integration, disabled state for main generate button"
      contains: "enableAIModal"
  key_links:
    - from: "App.tsx"
      to: "components/EnableAIModal.tsx"
      via: "state and render"
      pattern: "setEnableAIModal|<EnableAIModal"
    - from: "App.tsx"
      to: "components/SettingsModal.tsx"
      via: "autoFocusApiKey prop"
      pattern: "autoFocusApiKey={true}"
---

<objective>
Create EnableAIModal component and integrate disabled AI state into App.tsx

Purpose: When users click AI features without an API key, show a friendly invitation modal that guides them to Settings. This creates the foundation for disabled AI state across the app.

Output: EnableAIModal component, updated SettingsModal with auto-focus, App.tsx with modal integration and disabled "Generate Slideshow" button
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-disabled-ai-state/03-CONTEXT.md
@.planning/phases/03-disabled-ai-state/03-RESEARCH.md

Key files:
@App.tsx (lines 56-100, 164-201, 487-496, 675-701)
@components/SettingsModal.tsx (lines 41-60, 152-170)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create EnableAIModal component</name>
  <files>components/EnableAIModal.tsx</files>
  <action>
    Create a new EnableAIModal component with:

    Props interface:
    - featureName: string (e.g., "generate slides", "create quiz")
    - onOpenSettings: () => void

    Visual design (per CONTEXT.md decisions):
    - Centered lock icon decoration (large, in indigo/amber circle)
    - Heading: "Add an API key to unlock AI features!" (font-fredoka)
    - Body: "To {featureName}, add an API key in Settings."
    - Subtext: Brief explanation for newcomers about what API keys are
    - Mention: "Many providers offer free tiers to get started"
    - Single button: "Open Settings" (full width, primary style)
    - No dismiss button or close X (per CONTEXT.md - single action only)

    Styling:
    - Dark mode support (bg-white dark:bg-slate-800)
    - Same modal backdrop pattern as existing error modal
    - Rounded corners, shadow (match existing modal styles)
    - Animation: animate-fade-in (existing utility)

    Behavior:
    - Clicking "Open Settings" calls onOpenSettings() - parent handles closing modal
  </action>
  <verify>
    File exists at components/EnableAIModal.tsx
    Component exports EnableAIModal
    No dismiss option in component (single action)
  </verify>
  <done>
    EnableAIModal component created with friendly invitation tone, lock icon, and single "Open Settings" action
  </done>
</task>

<task type="auto">
  <name>Task 2: Add auto-focus prop to SettingsModal</name>
  <files>components/SettingsModal.tsx</files>
  <action>
    Modify SettingsModal to accept optional autoFocusApiKey prop:

    1. Add to props interface:
       autoFocusApiKey?: boolean (default false)

    2. Add ref for API key input:
       const apiKeyInputRef = useRef<HTMLInputElement>(null);

    3. Add useEffect for auto-focus:
       useEffect(() => {
         if (autoFocusApiKey && apiKeyInputRef.current) {
           // Small delay ensures modal animation completes
           setTimeout(() => {
             apiKeyInputRef.current?.focus();
           }, 100);
         }
       }, [autoFocusApiKey]);

    4. Add ref to the API key input element (~line 192-197):
       ref={apiKeyInputRef}

    Preserve all existing functionality - this is additive only.
  </action>
  <verify>
    npm run build (no TypeScript errors)
    SettingsModal props include autoFocusApiKey?: boolean
    API key input has ref attribute
  </verify>
  <done>
    SettingsModal accepts autoFocusApiKey prop and focuses API key input when true
  </done>
</task>

<task type="auto">
  <name>Task 3: Integrate EnableAIModal into App.tsx with disabled generate button</name>
  <files>App.tsx</files>
  <action>
    1. Import EnableAIModal:
       import EnableAIModal from './components/EnableAIModal';

    2. Add state for enable modal (near other modal state ~line 67):
       const [enableAIModal, setEnableAIModal] = useState<{featureName: string} | null>(null);
       const [settingsAutoFocus, setSettingsAutoFocus] = useState(false);

    3. Create handler for opening settings from enable modal:
       const handleOpenSettingsFromEnableModal = () => {
         setEnableAIModal(null);  // Close enable modal first
         setSettingsAutoFocus(true);
         setShowSettings(true);
       };

    4. Update SettingsModal render (~line 391-398) to pass autoFocusApiKey:
       <SettingsModal
         onClose={() => {
           setShowSettings(false);
           setSettingsAutoFocus(false);
           refreshSettings();
         }}
         autoFocusApiKey={settingsAutoFocus}
       />

    5. Render EnableAIModal (add near error modal ~line 700):
       {enableAIModal && (
         <EnableAIModal
           featureName={enableAIModal.featureName}
           onOpenSettings={handleOpenSettingsFromEnableModal}
         />
       )}

    6. Update "Generate Slideshow" button (~line 487-496) to show disabled state:
       - Wrap button in relative div for lock icon positioning
       - Add conditional opacity: className includes ${!provider ? 'opacity-50' : ''}
       - Add title attribute: title={!provider ? 'Add API key in Settings to enable' : undefined}
       - Modify onClick: if (!provider) { setEnableAIModal({featureName: 'generate slides'}); return; }
       - Add lock icon overlay when !provider:
         {!provider && (
           <span className="absolute -top-1 -right-1 w-5 h-5 bg-slate-500 dark:bg-slate-600 rounded-full flex items-center justify-center shadow-sm">
             <svg className="w-3 h-3 text-white" viewBox="0 0 20 20" fill="currentColor">
               <path fillRule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clipRule="evenodd" />
             </svg>
           </span>
         )}

    7. Create onRequestAI callback to pass to child components:
       const handleRequestAI = useCallback((featureName: string) => {
         if (!provider) {
           setEnableAIModal({ featureName });
         }
       }, [provider]);

    8. Pass handleRequestAI to child components that need it:
       - ResourceHub: add onRequestAI={handleRequestAI}
       - PresentationView: add onRequestAI={handleRequestAI}
       - SlideCard: needs to go through App.tsx handlers (already uses onError pattern)
  </action>
  <verify>
    npm run build (no TypeScript errors)
    npm run dev (app loads)
    Without API key: Generate Slideshow button appears grayed with lock icon
    Without API key: Clicking Generate Slideshow shows EnableAIModal
    Clicking "Open Settings" in modal opens Settings and focuses API key input
  </verify>
  <done>
    App.tsx integrates EnableAIModal, Generate Slideshow shows disabled state with lock icon when no API key, clicking opens friendly modal that leads to Settings with auto-focus
  </done>
</task>

</tasks>

<verification>
1. Without API key configured:
   - Generate Slideshow button appears grayed out (opacity-50)
   - Lock icon visible in top-right corner of button
   - Tooltip shows "Add API key in Settings to enable" on hover

2. Click Generate Slideshow without API key:
   - EnableAIModal appears with friendly invitation message
   - Shows lock icon decoration
   - Single "Open Settings" button visible (no dismiss option)

3. Click "Open Settings" in modal:
   - EnableAIModal closes
   - SettingsModal opens
   - API key input is focused automatically

4. App still works normally:
   - Can upload PDF, paste text (non-AI features work)
   - With API key configured, Generate Slideshow works as before
</verification>

<success_criteria>
- EnableAIModal component exists with friendly invitation tone
- SettingsModal auto-focuses API key input when autoFocusApiKey=true
- Generate Slideshow button shows disabled state (opacity + lock icon) when no API key
- Clicking disabled button shows EnableAIModal, not error modal
- Modal leads to Settings with auto-focused API key input
- npm run build succeeds with no errors
</success_criteria>

<output>
After completion, create `.planning/phases/03-disabled-ai-state/03-01-SUMMARY.md`
</output>
