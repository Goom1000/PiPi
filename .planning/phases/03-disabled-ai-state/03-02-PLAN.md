---
phase: 03-disabled-ai-state
plan: 02
type: execute
wave: 2
depends_on: ["03-01"]
files_modified:
  - components/SlideCard.tsx
  - components/ResourceHub.tsx
  - components/PresentationView.tsx
  - App.tsx
autonomous: true

must_haves:
  truths:
    - "All AI features show disabled state when no API key"
    - "Clicking any disabled AI feature opens EnableAIModal"
    - "App remains fully functional for non-AI workflows"
    - "Revise, Regenerate Image, Generate Resources, Generate Question, Game Mode all show lock icons"
  artifacts:
    - path: "components/SlideCard.tsx"
      provides: "Disabled state for Revise and Regenerate Image buttons"
      contains: "isAIAvailable|lock"
    - path: "components/ResourceHub.tsx"
      provides: "Disabled state for Generate Resources button"
      contains: "isAIAvailable|lock"
    - path: "components/PresentationView.tsx"
      provides: "Disabled state for question generation and quiz buttons"
      contains: "isAIAvailable|lock"
  key_links:
    - from: "components/SlideCard.tsx"
      to: "App.tsx"
      via: "new isAIAvailable and onRequestAI props"
      pattern: "isAIAvailable.*onRequestAI"
    - from: "components/ResourceHub.tsx"
      to: "App.tsx"
      via: "onRequestAI callback"
      pattern: "onRequestAI"
    - from: "components/PresentationView.tsx"
      to: "App.tsx"
      via: "onRequestAI callback"
      pattern: "onRequestAI"
---

<objective>
Apply disabled AI state to all child components with AI features

Purpose: Complete the disabled AI state implementation across SlideCard, ResourceHub, and PresentationView so all 7 AI features show consistent disabled appearance and open the EnableAIModal when clicked.

Output: All AI buttons in child components show lock icon and grayed state when no API key, clicking any triggers EnableAIModal
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/03-disabled-ai-state/03-CONTEXT.md
@.planning/phases/03-disabled-ai-state/03-RESEARCH.md
@.planning/phases/03-disabled-ai-state/03-01-SUMMARY.md

Key files:
@components/SlideCard.tsx (lines 38-44 Revise button, lines 175-181 Regenerate Image)
@components/ResourceHub.tsx (lines 25-46 handleGenerate, lines 260-262 button)
@components/PresentationView.tsx (lines 31-50 quiz handleStart, lines 299-317 question generation, lines 449-454 Game Mode button, lines 662-670 Grade buttons)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add disabled AI state to SlideCard</name>
  <files>components/SlideCard.tsx, App.tsx</files>
  <action>
    SlideCard.tsx changes:

    1. Update props interface to receive AI availability:
       isAIAvailable: boolean;
       onRequestAI: (featureName: string) => void;

    2. Update handleMagicEdit (~line 38-44):
       const handleMagicEdit = async () => {
         if (!revisionInput.trim()) return;
         if (!isAIAvailable) {
           onRequestAI('refine this slide with AI');
           return;
         }
         setIsRevising(true);
         await onRevise(slide.id, revisionInput);
         setRevisionInput('');
         setIsRevising(false);
       };

    3. Update Revise button (~line 145-151):
       - Add conditional opacity: className includes ${!isAIAvailable ? 'opacity-50' : ''}
       - Add title: title={!isAIAvailable ? 'Add API key in Settings to enable' : undefined}
       - Add relative positioning to button for lock icon
       - Add lock icon overlay when !isAIAvailable:
         {!isAIAvailable && (
           <span className="absolute -top-1 -right-1 w-4 h-4 bg-slate-500 dark:bg-slate-600 rounded-full flex items-center justify-center">
             <svg className="w-2.5 h-2.5 text-white" viewBox="0 0 20 20" fill="currentColor">
               <path fillRule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clipRule="evenodd" />
             </svg>
           </span>
         )}

    4. Update Regenerate Image button (~line 175-181):
       - Wrap in relative container if not already
       - Add onClick check: if (!isAIAvailable) { onRequestAI('regenerate this image'); return; }
       - Add conditional opacity and title
       - Add lock icon overlay

    App.tsx changes:

    5. Update SlideCard usage (~line 622-638):
       <SlideCard
         slide={activeSlide}
         index={activeSlideIndex}
         onUpdate={handleUpdateSlide}
         onDelete={handleDeleteSlide}
         onRegenerateImage={async (id, p) => {
           if (!provider) {
             setEnableAIModal({ featureName: 'regenerate this image' });
             return;
           }
           handleUpdateSlide(id, {isGeneratingImage: true});
           const img = await provider.generateSlideImage(p, activeSlide.layout);
           handleUpdateSlide(id, {imageUrl: img, isGeneratingImage: false});
         }}
         onRevise={handleReviseSlide}
         onInsertAfter={() => handleInsertBlankSlide(activeSlideIndex)}
         isAIAvailable={provider !== null}
         onRequestAI={handleRequestAI}
       />

    6. Also update handleReviseSlide to use enable modal instead of error modal:
       const handleReviseSlide = async (id: string, instruction: string) => {
         if (!provider) {
           setEnableAIModal({ featureName: 'refine this slide with AI' });
           return;
         }
         // ... rest unchanged
       };
  </action>
  <verify>
    npm run build (no TypeScript errors)
    Without API key: Revise button shows lock icon and grayed state
    Without API key: Regenerate Image button shows lock icon and grayed state
    Clicking either triggers EnableAIModal (not error modal)
  </verify>
  <done>
    SlideCard AI features (Revise, Regenerate Image) show disabled state with lock icons and trigger EnableAIModal when clicked
  </done>
</task>

<task type="auto">
  <name>Task 2: Add disabled AI state to ResourceHub</name>
  <files>components/ResourceHub.tsx, App.tsx</files>
  <action>
    ResourceHub.tsx changes:

    1. Add prop to interface:
       onRequestAI: (featureName: string) => void;

    2. Derive isAIAvailable from existing provider prop:
       const isAIAvailable = provider !== null;

    3. Update handleGenerate (~line 25-29):
       const handleGenerate = async () => {
         if (!isAIAvailable) {
           onRequestAI('generate classroom resources');
           return;
         }
         setIsGenerating(true);
         // ... rest unchanged
       };

    4. Update Generate Resources button (~line 260-262):
       - Make button container relative
       - Add opacity and title for disabled state
       - Add lock icon overlay when !isAIAvailable:
         <div className="relative">
           <Button
             onClick={handleGenerate}
             isLoading={isGenerating}
             className={`w-full ${!isAIAvailable ? 'opacity-50' : ''}`}
             title={!isAIAvailable ? 'Add API key in Settings to enable' : undefined}
           >
             Generate Resources
           </Button>
           {!isAIAvailable && (
             <span className="absolute -top-1 -right-1 w-4 h-4 bg-slate-500 dark:bg-slate-600 rounded-full flex items-center justify-center">
               <svg className="w-2.5 h-2.5 text-white" viewBox="0 0 20 20" fill="currentColor">
                 <path fillRule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clipRule="evenodd" />
               </svg>
             </span>
           )}
         </div>

    5. Same for Regenerate button (~line 279-281) - add disabled state

    App.tsx changes:

    6. Update ResourceHub usage (~line 381-389):
       <ResourceHub
         lessonText={lessonText}
         slideContext={JSON.stringify(slides)}
         onClose={() => setShowResourceHub(false)}
         provider={provider}
         onError={handleComponentError}
         onRequestAI={handleRequestAI}
       />
  </action>
  <verify>
    npm run build (no TypeScript errors)
    Without API key: Generate Resources button shows lock icon and grayed state
    Without API key: Regenerate button shows lock icon and grayed state
    Clicking either triggers EnableAIModal
  </verify>
  <done>
    ResourceHub AI feature (Generate Resources) shows disabled state with lock icon and triggers EnableAIModal when clicked
  </done>
</task>

<task type="auto">
  <name>Task 3: Add disabled AI state to PresentationView</name>
  <files>components/PresentationView.tsx, App.tsx</files>
  <action>
    PresentationView.tsx changes:

    1. Add prop to interface (~line 206-213):
       onRequestAI: (featureName: string) => void;

    2. Derive isAIAvailable:
       const isAIAvailable = provider !== null;

    3. Update QuizOverlay handleStart (~line 31-36):
       const handleStart = async () => {
         if (!provider) {
           onError('AI Not Configured', 'Please configure your AI provider in Settings.');
           onClose();
           return;
         }
         // Already handles this, but update to use onRequestAI instead:
         // Actually, QuizOverlay receives provider and onError directly
         // We need to pass onRequestAI to QuizOverlay too
       };

    4. Update QuizOverlay props and component to accept onRequestAI:
       const QuizOverlay: React.FC<{
         slides: Slide[];
         currentIndex: number;
         onClose: () => void;
         provider: AIProviderInterface | null;
         onError: (title: string, message: string) => void;
         onRequestAI: (featureName: string) => void;
       }> = ({ slides, currentIndex, onClose, provider, onError, onRequestAI }) => {

       Update handleStart:
       const handleStart = async () => {
         if (!provider) {
           onRequestAI('start the quiz game');
           onClose();
           return;
         }
         // ... rest unchanged
       };

    5. Update Game Mode button (~line 449-454):
       - Add disabled visual state when !isAIAvailable
       - The button click opens QuizOverlay which handles the check internally
       - Add lock icon to the button itself for visual indication:
         <div className="relative">
           <button
             onClick={() => setIsQuizModalOpen(true)}
             className={`px-3 py-1.5 rounded-lg text-xs font-bold uppercase tracking-wider transition-colors border bg-indigo-600 border-indigo-500 hover:bg-indigo-500 text-white shadow-lg shadow-indigo-500/30 flex items-center gap-2 ${!isAIAvailable ? 'opacity-50' : ''}`}
             title={!isAIAvailable ? 'Add API key in Settings to enable' : undefined}
           >
             <span>Game Mode</span>
           </button>
           {!isAIAvailable && (
             <span className="absolute -top-1 -right-1 w-4 h-4 bg-slate-500 rounded-full flex items-center justify-center">
               <svg className="w-2.5 h-2.5 text-white" viewBox="0 0 20 20" fill="currentColor">
                 <path fillRule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clipRule="evenodd" />
               </svg>
             </span>
           )}
         </div>

    6. Update handleGenerateQuestion (~line 299-317):
       const handleGenerateQuestion = async (level: 'Grade C' | 'Grade B' | 'Grade A') => {
         if (!provider) {
           onRequestAI(`generate a ${level} question`);
           return;
         }
         // ... rest unchanged
       };

    7. Update Grade C/B/A buttons (~line 662-670):
       - Add disabled state to each button:
         <div className="relative">
           <button
             onClick={() => handleGenerateQuestion('Grade C')}
             className={`bg-emerald-800/50 hover:bg-emerald-700 text-emerald-200 border border-emerald-700/50 rounded-lg py-2 text-[10px] font-bold uppercase tracking-wider transition-colors w-full ${!isAIAvailable ? 'opacity-50' : ''}`}
             title={!isAIAvailable ? 'Add API key in Settings to enable' : undefined}
           >
             Grade C ?
           </button>
           {!isAIAvailable && (
             <span className="absolute -top-0.5 -right-0.5 w-3 h-3 bg-slate-500 rounded-full flex items-center justify-center">
               <svg className="w-2 h-2 text-white" viewBox="0 0 20 20" fill="currentColor">
                 <path fillRule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clipRule="evenodd" />
               </svg>
             </span>
           )}
         </div>
       - Repeat for Grade B and Grade A buttons

    8. Pass onRequestAI to QuizOverlay render (~line 594-602):
       <QuizOverlay
         slides={slides}
         currentIndex={currentIndex}
         onClose={() => setIsQuizModalOpen(false)}
         provider={provider}
         onError={onError}
         onRequestAI={onRequestAI}
       />

    App.tsx changes:

    9. Update PresentationView usage (~line 313-322):
       <PresentationView
         slides={slides}
         onExit={() => setAppState(AppState.EDITING)}
         studentNames={studentNames}
         initialSlideIndex={presentationStartIndex}
         provider={provider}
         onError={handleComponentError}
         onRequestAI={handleRequestAI}
       />
  </action>
  <verify>
    npm run build (no TypeScript errors)
    Without API key: Game Mode button shows lock icon and grayed state
    Without API key: Grade C/B/A buttons show lock icons and grayed state
    Clicking any triggers EnableAIModal
  </verify>
  <done>
    PresentationView AI features (Game Mode quiz, Grade C/B/A question generation) show disabled state with lock icons and trigger EnableAIModal when clicked
  </done>
</task>

</tasks>

<verification>
1. Start app without any API key configured

2. Test SlideCard (need to generate slides first with API key, then clear it):
   - Revise button shows lock icon and grayed opacity
   - Regenerate Image button shows lock icon and grayed opacity
   - Clicking either opens EnableAIModal

3. Test ResourceHub:
   - Click Resources button in header (editing mode)
   - Generate Resources button shows lock icon and grayed opacity
   - Clicking opens EnableAIModal

4. Test PresentationView:
   - Enter presentation mode (need some slides)
   - Game Mode button shows lock icon and grayed opacity
   - Grade C/B/A buttons show lock icons and grayed opacity
   - Clicking any opens EnableAIModal

5. Non-AI features still work:
   - Can edit slide titles and content manually
   - Can delete slides
   - Can present slides
   - Can navigate in presentation
   - Can add blank slides
</verification>

<success_criteria>
- All 7 AI features across 4 components show disabled state (opacity + lock icon) when no API key
- Clicking any disabled AI feature opens EnableAIModal (not error modal)
- Tooltips show "Add API key in Settings to enable" on hover
- Non-AI functionality unchanged
- npm run build succeeds with no errors
- App remains fully usable without API key for non-AI workflows
</success_criteria>

<output>
After completion, create `.planning/phases/03-disabled-ai-state/03-02-SUMMARY.md`
</output>
