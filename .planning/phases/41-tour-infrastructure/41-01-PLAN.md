---
phase: 41-tour-infrastructure
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - package.json
  - components/InfoTooltip.tsx
  - styles/driver.css
autonomous: true

must_haves:
  truths:
    - "User sees info icon (i) button next to complex features"
    - "User can trigger tooltip via hover or keyboard focus"
    - "User sees tooltip content explaining feature purpose"
    - "User can dismiss tooltip via Escape key or clicking away"
    - "Tooltip appears above all existing UI elements"
  artifacts:
    - path: "components/InfoTooltip.tsx"
      provides: "Reusable accessible tooltip component"
      exports: ["InfoTooltip"]
    - path: "styles/driver.css"
      provides: "Custom driver.js theme matching Cue design"
      contains: ".cue-tour-popover"
  key_links:
    - from: "components/InfoTooltip.tsx"
      to: "@floating-ui/react"
      via: "useFloating, useHover, useFocus, useDismiss, useRole"
      pattern: "import.*from.*@floating-ui/react"
---

<objective>
Install driver.js and Floating UI libraries, create InfoTooltip component with full accessibility support.

Purpose: Establish the foundational libraries and create the reusable tooltip component that will be used across all screens for feature explanations.

Output: Working InfoTooltip component that triggers on hover/focus, positions correctly, respects accessibility requirements, and matches Cue's design system (light/dark mode, rounded corners, shadows).
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/41-tour-infrastructure/41-RESEARCH.md
@hooks/useSettings.ts
@components/Button.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Install driver.js and Floating UI</name>
  <files>package.json</files>
  <action>
Install driver.js and @floating-ui/react packages:

```bash
npm install driver.js @floating-ui/react
```

Verify package.json includes:
- "driver.js": "^1.4.0" (or latest 1.x)
- "@floating-ui/react": "^0.26.x" (or latest 0.26.x)

Do NOT install @floating-ui/react-dom separately - @floating-ui/react includes it.
  </action>
  <verify>
Run `npm ls driver.js @floating-ui/react` - both packages listed with versions.
Run `npm run typecheck` - no TypeScript errors from new packages.
  </verify>
  <done>Both libraries installed, npm install succeeds, typecheck passes.</done>
</task>

<task type="auto">
  <name>Task 2: Create InfoTooltip component</name>
  <files>components/InfoTooltip.tsx</files>
  <action>
Create `components/InfoTooltip.tsx` - an accessible tooltip component using Floating UI.

Component requirements:
1. **Trigger:** Small info icon button (i) - 20x20px, rounded-full, slate-100 dark:slate-700 background
2. **Hover:** useHover with 200ms open delay, 0ms close delay
3. **Focus:** useFocus for keyboard accessibility (A11Y-02)
4. **Dismiss:** useDismiss for Escape key and click-outside (A11Y-05)
5. **ARIA:** useRole with role="tooltip" (A11Y-03)
6. **Positioning:** offset(10), flip(), shift({ padding: 8 }) for viewport collision handling
7. **Portal:** FloatingPortal to render above all content
8. **Z-index:** z-[10001] on tooltip content (above z-10000 tour overlay)
9. **Arrow:** FloatingArrow for visual connection to trigger
10. **Dark mode:** Light tooltip on dark bg in dark mode (slate-100 bg, slate-900 text), dark tooltip in light mode (slate-900 bg, white text)
11. **Styling:** max-w-xs, rounded-xl, px-4 py-3, shadow-xl, text-sm
12. **Focus indicator:** focus-visible:ring-2 focus-visible:ring-indigo-500 dark:focus-visible:ring-amber-500 on button (A11Y-04)

Props interface:
```typescript
interface InfoTooltipProps {
  content: React.ReactNode;
  children?: React.ReactNode; // Optional custom trigger, defaults to (i) button
}
```

Follow the pattern from RESEARCH.md "Floating UI Complete Tooltip" code example.

Import pattern from existing components - use single quotes for imports.
  </action>
  <verify>
Run `npm run typecheck` - no TypeScript errors.
Visually test: Import in App.tsx temporarily, render `<InfoTooltip content="Test">` next to any button, verify:
- (i) button appears
- Hover shows tooltip
- Tab to button shows tooltip (keyboard focus)
- Escape dismisses tooltip
- Dark mode inverts colors correctly
  </verify>
  <done>InfoTooltip component works with hover, focus, dismiss, proper z-index, dark mode support.</done>
</task>

<task type="auto">
  <name>Task 3: Create driver.js custom CSS</name>
  <files>styles/driver.css</files>
  <action>
Create `styles/driver.css` with Cue-themed driver.js styles.

Requirements (from RESEARCH.md "Driver.js Dark Mode CSS Override"):
1. Create styles/ directory if needed
2. Override driver.js popover styles to match Cue design system:
   - Light mode: white bg (#ffffff), slate-800 text (#1e293b)
   - Dark mode: slate-800 bg (#1e293b), slate-50 text (#f8fafc)
   - border-radius: 16px (rounded-2xl)
   - box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25) (shadow-2xl)
3. Button styling:
   - Next button: indigo-600 bg in light, amber-500 bg in dark
   - Button border-radius: 12px (rounded-xl)
   - Focus rings: indigo-500 light, amber-500 dark
4. Z-index overrides:
   - .driver-popover: z-index: 10001 !important
   - .driver-overlay: z-index: 10000 !important
5. Progress indicator styling to match Cue theme
6. Use .cue-tour-popover class for custom styles (set via popoverClass in driver config)
7. Dark mode via `.dark .cue-tour-popover` selector pattern (Cue adds .dark to html element)

Also import base driver.js CSS at top:
```css
@import 'driver.js/dist/driver.css';
```

Note: This file will be imported in App.tsx in Phase 42+ when tours are implemented. For now, just create the file.
  </action>
  <verify>
File exists at styles/driver.css with:
- @import 'driver.js/dist/driver.css' at top
- .cue-tour-popover class with light mode styles
- .dark .cue-tour-popover selector with dark mode styles
- z-index overrides for .driver-popover and .driver-overlay
  </verify>
  <done>driver.css exists with complete Cue-themed styles, ready for tour implementation.</done>
</task>

</tasks>

<verification>
After all tasks complete:
1. `npm run typecheck` passes with no errors
2. `npm run dev` starts without errors
3. InfoTooltip component exists and is importable
4. styles/driver.css exists with Cue theme
5. Package.json includes both new dependencies
</verification>

<success_criteria>
- driver.js ^1.4.x installed
- @floating-ui/react ^0.26.x installed
- InfoTooltip component created with:
  - Hover trigger (200ms delay)
  - Keyboard focus trigger (A11Y-02)
  - Escape dismisses (A11Y-05)
  - ARIA tooltip role (A11Y-03)
  - Visible focus indicator (A11Y-04)
  - Dark mode support
  - z-[10001] positioning
- driver.css created with Cue theme and z-index overrides (z-10000+ per TOUR-05)
</success_criteria>

<output>
After completion, create `.planning/phases/41-tour-infrastructure/41-01-SUMMARY.md`
</output>
