---
phase: 33-upfront-verbosity-selection
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - services/aiProvider.ts
  - services/geminiService.ts
  - services/providers/claudeProvider.ts
  - App.tsx
autonomous: true

must_haves:
  truths:
    - "User sees verbosity selector (Concise/Standard/Detailed) on landing page after uploading a file"
    - "Selected verbosity level is passed to AI and used for initial teleprompter content generation"
    - "When no selection is made, slides generate with Standard verbosity by default"
  artifacts:
    - path: "services/aiProvider.ts"
      provides: "Extended GenerationInput with verbosity field"
      contains: "verbosity?: VerbosityLevel"
    - path: "services/geminiService.ts"
      provides: "Verbosity-aware system instruction generation"
      contains: "getTeleprompterRulesForVerbosity"
    - path: "services/providers/claudeProvider.ts"
      provides: "Verbosity-aware system prompt generation"
      contains: "getTeleprompterRulesForVerbosity"
    - path: "App.tsx"
      provides: "Upfront verbosity state and UI selector"
      contains: "upfrontVerbosity"
  key_links:
    - from: "App.tsx"
      to: "services/aiProvider.ts"
      via: "GenerationInput.verbosity field"
      pattern: "verbosity: upfrontVerbosity"
    - from: "services/geminiService.ts"
      to: "TELEPROMPTER_RULES variants"
      via: "getTeleprompterRulesForVerbosity helper"
      pattern: "input\\.verbosity"
---

<objective>
Add upfront verbosity selection to the landing page so teachers can choose their preferred teleprompter style (Concise/Standard/Detailed) before generating slides.

Purpose: Teachers can set their preferred verbosity level upfront, reducing post-generation regeneration API calls. Extends v3.1 per-slide verbosity to work at generation time.

Output: Working verbosity selector on landing page that affects initial slide generation.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/33-upfront-verbosity-selection/33-RESEARCH.md

Key files:
@services/aiProvider.ts (GenerationInput interface, VerbosityLevel re-export)
@services/geminiService.ts (TELEPROMPTER_RULES variants, getSystemInstructionForMode)
@services/providers/claudeProvider.ts (TELEPROMPTER_RULES variants, getSystemPromptForMode)
@App.tsx (Landing page UI, handleGenerate, state declarations)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend AI generation pipeline with verbosity parameter</name>
  <files>
    services/aiProvider.ts
    services/geminiService.ts
    services/providers/claudeProvider.ts
  </files>
  <action>
    **services/aiProvider.ts:**
    1. Add `verbosity?: VerbosityLevel` field to the `GenerationInput` interface (after `mode` field)
    2. This field is optional to maintain backward compatibility - callers not passing verbosity get Standard by default

    **services/geminiService.ts:**
    1. Add helper function `getTeleprompterRulesForVerbosity(verbosity: VerbosityLevel = 'standard'): string`
       - Returns `TELEPROMPTER_RULES_CONCISE` for 'concise'
       - Returns `TELEPROMPTER_RULES_DETAILED` for 'detailed'
       - Returns `TELEPROMPTER_RULES` (standard) for 'standard' and default
    2. Modify `getSystemInstructionForMode` signature to accept optional verbosity parameter:
       `function getSystemInstructionForMode(mode: GenerationMode, verbosity: VerbosityLevel = 'standard'): string`
    3. Inside `getSystemInstructionForMode`, replace hardcoded `${TELEPROMPTER_RULES}` with:
       `const teleprompterRules = getTeleprompterRulesForVerbosity(verbosity);`
       Then use `${teleprompterRules}` in all three mode cases (fresh, refine, blend)
    4. In `generateLessonSlides`, update the call to `getSystemInstructionForMode`:
       `const systemInstruction = getSystemInstructionForMode(input.mode, input.verbosity);`

    **services/providers/claudeProvider.ts:**
    1. Add the same `getTeleprompterRulesForVerbosity` helper function (copy pattern from geminiService)
    2. Modify `getSystemPromptForMode` signature to accept optional verbosity parameter:
       `function getSystemPromptForMode(mode: GenerationMode, verbosity: VerbosityLevel = 'standard'): string`
    3. Replace hardcoded `${TELEPROMPTER_RULES}` with dynamic verbosity rules in all three mode cases
    4. In `generateLessonSlides` method, update the call:
       `const systemPrompt = getSystemPromptForMode(input.mode, input.verbosity);`

    **Why optional verbosity:** Backward compatibility - existing callers (tests, edge cases) continue working with Standard verbosity as default.
  </action>
  <verify>
    - `npm run build` passes with no type errors
    - Search codebase: `grep -r "verbosity.*VerbosityLevel" services/` shows the new field
    - Search codebase: `grep -r "getTeleprompterRulesForVerbosity" services/` shows helper in both providers
  </verify>
  <done>
    GenerationInput interface has verbosity field. Both Gemini and Claude providers use verbosity parameter when building system instructions for slide generation. Defaults to 'standard' when not provided.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add verbosity selector UI to landing page</name>
  <files>App.tsx</files>
  <action>
    **State declaration (near line 202, after autoGenerateImages):**
    1. Import VerbosityLevel: Add to existing import from './services/aiProvider':
       `import { createAIProvider, AIProviderError, AIProviderInterface, GenerationInput, GenerationMode, AIErrorCode, VerbosityLevel } from './services/aiProvider';`
    2. Add state: `const [upfrontVerbosity, setUpfrontVerbosity] = useState<VerbosityLevel>('standard');`

    **UI (after Mode Indicator around line 1227, before the "Or paste text below" divider):**
    Add verbosity selector that only shows when `uploadMode !== 'none'`:

    ```tsx
    {/* Verbosity Selection */}
    {uploadMode !== 'none' && (
      <div className="flex items-center justify-between bg-slate-50 dark:bg-slate-800 p-4 rounded-2xl border border-slate-100 dark:border-slate-700 mb-6">
        <div className="flex items-center gap-3">
          <div className="w-10 h-10 bg-indigo-50 dark:bg-indigo-900/30 text-indigo-600 dark:text-indigo-400 rounded-xl flex items-center justify-center shadow-sm">
            <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16m-7 6h7" />
            </svg>
          </div>
          <div>
            <p className="font-bold text-slate-700 dark:text-slate-300">Teleprompter Style</p>
            <p className="text-xs text-slate-500 dark:text-slate-500">
              {upfrontVerbosity === 'concise' && 'Brief prompts for experienced teachers'}
              {upfrontVerbosity === 'standard' && 'Balanced guidance with examples'}
              {upfrontVerbosity === 'detailed' && 'Full script you can read verbatim'}
            </p>
          </div>
        </div>
        <div className="flex gap-1">
          {(['concise', 'standard', 'detailed'] as const).map(level => (
            <button
              key={level}
              onClick={() => setUpfrontVerbosity(level)}
              className={`px-3 py-1.5 text-xs font-bold uppercase tracking-wider rounded-lg transition-all ${
                upfrontVerbosity === level
                  ? 'bg-indigo-600 dark:bg-amber-500 text-white shadow-lg'
                  : 'bg-slate-200 dark:bg-slate-700 text-slate-500 dark:text-slate-400 hover:text-slate-700 dark:hover:text-white'
              }`}
            >
              {level}
            </button>
          ))}
        </div>
      </div>
    )}
    ```

    **Wire to generation (in handleGenerate around line 346):**
    Add verbosity to the GenerationInput object:
    ```typescript
    const generationInput: GenerationInput = {
      lessonText: lessonText,
      lessonImages: pageImages.length > 0 ? pageImages : undefined,
      presentationText: existingPptText || undefined,
      presentationImages: existingPptImages.length > 0 ? existingPptImages : undefined,
      mode: uploadMode as GenerationMode,
      verbosity: upfrontVerbosity,  // ADD THIS LINE
    };
    ```

    **Placement note:** The verbosity selector should appear after the Mode Indicator box and before the "Or paste text below" divider. This groups all "AI generation options" together (mode indicator, verbosity selector, then text input, then auto-images toggle).
  </action>
  <verify>
    - `npm run build` passes
    - `npm run dev` - visit landing page
    - Upload a PDF (lesson plan or presentation) - verbosity selector should appear
    - Select "Detailed", then generate slides - verify teleprompter content is verbose (full sentences, transitions)
    - Clear and re-upload, leave as "Standard" - verify teleprompter is moderate length
    - Test "Concise" - verify teleprompter is bullet-point style, minimal
  </verify>
  <done>
    Verbosity selector visible on landing page after file upload. Selected level is passed to AI generation. Default is Standard. Three verbosity levels produce distinctly different teleprompter content.
  </done>
</task>

</tasks>

<verification>
1. **UPFR-01 (UI):** Upload any PDF - verbosity selector (Concise/Standard/Detailed) appears below Mode Indicator
2. **UPFR-02 (Generation):** Select "Detailed", generate slides - teleprompter scripts have full sentences, transitions, teacher actions
3. **UPFR-03 (Default):** Fresh page load, upload PDF, immediately generate without touching verbosity - teleprompter uses Standard style (moderate length, balanced)
4. **Cross-provider:** Test with both Gemini and Claude (if keys available) - both should respect verbosity selection
5. **Build:** `npm run build` completes without errors
</verification>

<success_criteria>
- Verbosity selector appears on landing page after file upload (not before)
- Three buttons: Concise, Standard, Detailed - with clear visual active state
- Description text updates based on selection
- Generated slides have teleprompter content matching selected verbosity level
- Standard is pre-selected by default
- Build passes with no type errors
</success_criteria>

<output>
After completion, create `.planning/phases/33-upfront-verbosity-selection/33-01-SUMMARY.md`
</output>
