---
phase: 25-competition-modes
plan: 04
type: execute
wave: 3
depends_on: ["25-01", "25-02"]
files_modified:
  - components/PresentationView.tsx
  - components/games/beat-the-chaser/SetupModal.tsx
autonomous: true

must_haves:
  truths:
    - "Competition mode selection appears in Quick Quiz launch flow"
    - "Competition mode selection appears in Millionaire setup modal"
    - "Competition mode selection appears in The Chase setup modal"
    - "Competition mode selection appears in Beat the Chaser setup modal"
    - "Competition mode is passed through to game state on launch"
  artifacts:
    - path: "components/PresentationView.tsx"
      provides: "Integrated setup modals with competition mode"
      contains: "CompetitionModeSection"
    - path: "components/games/beat-the-chaser/SetupModal.tsx"
      provides: "Updated Beat the Chaser setup with competition mode"
      contains: "CompetitionModeSection"
  key_links:
    - from: "components/PresentationView.tsx"
      to: "components/games/shared/CompetitionModeSection.tsx"
      via: "import CompetitionModeSection"
      pattern: "import CompetitionModeSection"
---

<objective>
Integrate CompetitionModeSection into all game setup flows.

Purpose: Add competition mode configuration to every game's launch flow so teachers can select individual or team mode before starting any game.

Output: Updated PresentationView.tsx (Quick Quiz, Millionaire, The Chase modals) and SetupModal.tsx (Beat the Chaser)
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/25-competition-modes/25-CONTEXT.md
@.planning/phases/25-competition-modes/25-01-SUMMARY.md
@.planning/phases/25-competition-modes/25-02-SUMMARY.md
@types.ts
@components/games/shared/CompetitionModeSection.tsx
@components/PresentationView.tsx
@components/games/beat-the-chaser/SetupModal.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add competition mode to PresentationView setup modals</name>
  <files>components/PresentationView.tsx</files>
  <action>
Update `components/PresentationView.tsx` to integrate competition mode into all inline setup modals:

1. **Add imports** (near top of file):
```typescript
import CompetitionModeSection from './games/shared/CompetitionModeSection';
import { CompetitionMode } from '../types';
```

2. **Add state for competition mode** (near other game state ~line 111):
```typescript
const [competitionMode, setCompetitionMode] = useState<CompetitionMode>({
  mode: 'individual',
  playerName: ''
});
```

3. **Create Quick Quiz setup modal** (Quick Quiz currently has no setup modal - launches directly).
   Change the Quick Quiz branch in `handleSelectGame` to show a setup modal instead:

In `handleSelectGame` (around line 509), change:
```typescript
if (gameType === 'quick-quiz') {
  // Launch Quick Quiz - needs to generate questions first
  setPendingGameType('quick-quiz');
  launchQuickQuiz();
}
```
To:
```typescript
if (gameType === 'quick-quiz') {
  setShowQuickQuizSetup(true);
}
```

Add new state variable:
```typescript
const [showQuickQuizSetup, setShowQuickQuizSetup] = useState(false);
```

4. **Add Quick Quiz Setup Modal** (after the existing modals, around line 1409):
```jsx
{/* Quick Quiz Setup Modal */}
{showQuickQuizSetup && (
  <div className="fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm flex items-center justify-center animate-fade-in">
    <div className="bg-slate-800 rounded-2xl p-8 max-w-md w-full border-2 border-indigo-400/30 shadow-2xl">
      <h3 className="text-3xl font-black text-white mb-2 text-center">Quick Quiz</h3>
      <p className="text-slate-300 text-center mb-6">Kahoot-style questions</p>

      <CompetitionModeSection
        value={competitionMode}
        onChange={setCompetitionMode}
      />

      <div className="flex gap-3">
        <button
          onClick={() => {
            setShowQuickQuizSetup(false);
            setCompetitionMode({ mode: 'individual', playerName: '' });
          }}
          className="flex-1 py-3 text-slate-400 hover:text-white transition-colors"
        >
          Cancel
        </button>
        <button
          onClick={() => {
            setShowQuickQuizSetup(false);
            setPendingGameType('quick-quiz');
            launchQuickQuiz();
          }}
          disabled={!isAIAvailable}
          className={`flex-1 py-3 font-bold rounded-xl transition-all ${
            isAIAvailable
              ? 'bg-indigo-600 hover:bg-indigo-500 text-white hover:scale-105'
              : 'bg-slate-700 text-slate-500 cursor-not-allowed'
          }`}
        >
          Start Game
        </button>
      </div>
      {!isAIAvailable && (
        <p className="text-sm text-amber-400 text-center mt-4">
          Add an API key in Settings to enable
        </p>
      )}
    </div>
  </div>
)}
```

5. **Update Millionaire Setup Modal** (~line 1356):
Add CompetitionModeSection before the question count buttons:
```jsx
{showMillionaireSetup && (
  <div className="fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm flex items-center justify-center animate-fade-in">
    <div className="bg-slate-800 rounded-2xl p-8 max-w-md w-full border-2 border-indigo-400/30 shadow-2xl">
      <h3 className="text-3xl font-black text-white mb-2 text-center">Millionaire</h3>
      <p className="text-slate-300 text-center mb-6">How many questions?</p>

      <CompetitionModeSection
        value={competitionMode}
        onChange={setCompetitionMode}
      />

      <div className="space-y-3">
        {/* Existing 3/5/10 question buttons stay the same */}
```

6. **Update The Chase Setup Modal** (~line 1412):
Add CompetitionModeSection before the "Chaser Control" section:
```jsx
{showChaseSetup && (
  <div className="fixed inset-0 z-[200] bg-black/80 backdrop-blur-sm flex items-center justify-center animate-fade-in">
    <div className="bg-slate-800 rounded-2xl p-8 max-w-xl w-full border-2 border-red-400/30 shadow-2xl">
      <h3 className="text-3xl font-black text-white mb-2 text-center">The Chase</h3>
      <p className="text-slate-300 text-center mb-6">Configure game settings</p>

      <CompetitionModeSection
        value={competitionMode}
        onChange={setCompetitionMode}
      />

      {/* Existing Control Mode Toggle and Difficulty Selection stay the same */}
```

7. **Reset competition mode when modals close**:
Update cancel buttons to reset: `setCompetitionMode({ mode: 'individual', playerName: '' })`

Note: The actual passing of competitionMode to game state will be done in Plan 05 (orchestrator integration). This plan focuses on UI integration only.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Search for integration: `grep "CompetitionModeSection" components/PresentationView.tsx`
  </verify>
  <done>
PresentationView has CompetitionModeSection integrated into Quick Quiz, Millionaire, and The Chase setup modals
  </done>
</task>

<task type="auto">
  <name>Task 2: Add competition mode to Beat the Chaser SetupModal</name>
  <files>components/games/beat-the-chaser/SetupModal.tsx</files>
  <action>
Update `components/games/beat-the-chaser/SetupModal.tsx`:

1. **Add imports**:
```typescript
import CompetitionModeSection from '../shared/CompetitionModeSection';
import { CompetitionMode } from '../../../types';
```

2. **Add state** (inside component):
```typescript
const [competitionMode, setCompetitionMode] = useState<CompetitionMode>({
  mode: 'individual',
  playerName: ''
});
```

3. **Update props interface**:
```typescript
interface SetupModalProps {
  onStart: (
    difficulty: BeatTheChaserDifficulty,
    isAIControlled: boolean,
    competitionMode: CompetitionMode
  ) => void;
  onCancel: () => void;
}
```

4. **Add CompetitionModeSection** to the modal JSX (after "Beat the Chaser Setup" header, before Difficulty Selection):
```jsx
<h2 className="text-3xl font-black text-amber-400 mb-6 text-center">
  Beat the Chaser Setup
</h2>

<CompetitionModeSection
  value={competitionMode}
  onChange={setCompetitionMode}
/>

{/* Existing Difficulty Selection */}
<div className="mb-6">
```

5. **Update Start button** to pass competition mode:
```jsx
<button
  onClick={() => onStart(selectedDifficulty, isAIControlled, competitionMode)}
  className="flex-1 py-3 px-6 bg-amber-500 hover:bg-amber-400 text-amber-950 font-bold rounded-xl transition-colors"
>
  Start Game
</button>
```

Note: The caller (BeatTheChaserGame.tsx) will need updating in Plan 05 to handle the competitionMode parameter.
  </action>
  <verify>
TypeScript compiles: `npx tsc --noEmit`
Search for integration: `grep "CompetitionModeSection" components/games/beat-the-chaser/SetupModal.tsx`
  </verify>
  <done>
Beat the Chaser SetupModal includes CompetitionModeSection and passes competition mode to onStart
  </done>
</task>

</tasks>

<verification>
```bash
# TypeScript compiles
npx tsc --noEmit

# CompetitionModeSection imported in both files
grep "import CompetitionModeSection" components/PresentationView.tsx
grep "import CompetitionModeSection" components/games/beat-the-chaser/SetupModal.tsx

# Competition mode state exists
grep "competitionMode" components/PresentationView.tsx | head -5
grep "competitionMode" components/games/beat-the-chaser/SetupModal.tsx | head -5
```
</verification>

<success_criteria>
- [ ] Quick Quiz has new setup modal with CompetitionModeSection
- [ ] Millionaire setup modal includes CompetitionModeSection
- [ ] The Chase setup modal includes CompetitionModeSection
- [ ] Beat the Chaser SetupModal includes CompetitionModeSection
- [ ] Competition mode state managed correctly in both files
- [ ] Cancel buttons reset competition mode to default
- [ ] TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/25-competition-modes/25-04-SUMMARY.md`
</output>
