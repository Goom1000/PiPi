---
phase: 24-beat-the-chaser
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - types.ts
  - components/games/beat-the-chaser/SetupModal.tsx
  - components/games/beat-the-chaser/beatTheChaserConfig.ts
autonomous: true

must_haves:
  truths:
    - "BeatTheChaserState includes phase, difficulty, and timed battle fields"
    - "Difficulty config defines time ratios and AI accuracy ranges"
    - "Setup modal allows difficulty selection before game start"
  artifacts:
    - path: "types.ts"
      provides: "Extended BeatTheChaserState type"
      contains: "BeatTheChaserPhase"
    - path: "components/games/beat-the-chaser/beatTheChaserConfig.ts"
      provides: "Difficulty configuration constants"
      exports: ["BEAT_THE_CHASER_DIFFICULTY", "BeatTheChaserDifficulty"]
    - path: "components/games/beat-the-chaser/SetupModal.tsx"
      provides: "Difficulty selection UI"
      exports: ["default"]
  key_links:
    - from: "types.ts"
      to: "BeatTheChaserState"
      via: "type extension"
      pattern: "BeatTheChaserPhase.*cash-builder.*timed-battle"
---

<objective>
Extend BeatTheChaserState type system and create setup modal for difficulty selection.

Purpose: Establish type-safe foundation for Beat the Chaser game with proper phase management and difficulty configuration. Difficulty affects chaser's starting time as a ratio of contestant's accumulated time (80%/100%/120%) and AI accuracy ranges.

Output: Extended types, difficulty config, and setup modal component ready for game orchestrator.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/24-beat-the-chaser/24-CONTEXT.md
@.planning/phases/24-beat-the-chaser/24-RESEARCH.md
@types.ts
@hooks/useChaserAI.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Extend BeatTheChaserState type</name>
  <files>types.ts</files>
  <action>
Extend the existing BeatTheChaserState interface to include all necessary fields for the game:

1. Add BeatTheChaserPhase type union:
   ```typescript
   export type BeatTheChaserPhase = 'setup' | 'cash-builder' | 'timed-battle' | 'game-over';
   ```

2. Extend BeatTheChaserState with these fields:
   - phase: BeatTheChaserPhase (game phase tracking)
   - accumulatedTime: number (seconds earned in Cash Builder, 5s per correct)
   - chaserDifficulty: 'easy' | 'medium' | 'hard' (affects time ratio and AI accuracy)
   - isAIControlled: boolean (true = AI chaser, false = manual control)
   - cashBuilderQuestionsAnswered: number (tracking progress)
   - cashBuilderCorrectAnswers: number (tracking correct count)
   - contestantAnswer: number | null (current turn state)
   - chaserAnswer: number | null (current turn state)
   - showTimeBonusEffect: boolean (for +5s animation trigger)
   - winner: 'contestant' | 'chaser' | null (game outcome)

Keep existing fields: contestantTime, chaserTime, activePlayer (rename from current minimal definition).

The existing BeatTheChaserState is minimal - expand it to match TheChaseState pattern but simpler.
  </action>
  <verify>TypeScript compiles without errors: `cd "/Users/ricky/Documents/App_Projects/Education Apps/DEV - PiPi" && npx tsc --noEmit`</verify>
  <done>BeatTheChaserState includes phase, difficulty, battle state, and outcome fields</done>
</task>

<task type="auto">
  <name>Task 2: Create difficulty configuration</name>
  <files>components/games/beat-the-chaser/beatTheChaserConfig.ts</files>
  <action>
Create configuration constants file at components/games/beat-the-chaser/beatTheChaserConfig.ts:

```typescript
export type BeatTheChaserDifficulty = 'easy' | 'medium' | 'hard';

export interface DifficultyConfig {
  timeRatio: number;              // Chaser time as fraction of contestant time
  aiAccuracyRange: [number, number];  // Min/max accuracy percentage
  label: string;                  // Display label
  description: string;            // Help text
}

export const BEAT_THE_CHASER_DIFFICULTY: Record<BeatTheChaserDifficulty, DifficultyConfig> = {
  easy: {
    timeRatio: 0.80,              // Chaser gets 80% of contestant's time
    aiAccuracyRange: [0.50, 0.60], // 50-60% accuracy
    label: 'Easy',
    description: 'Chaser has less time and makes more mistakes'
  },
  medium: {
    timeRatio: 1.00,              // Equal time
    aiAccuracyRange: [0.70, 0.80], // 70-80% accuracy
    label: 'Medium',
    description: 'Fair fight - equal time for both players'
  },
  hard: {
    timeRatio: 1.20,              // Chaser gets 120% of contestant's time
    aiAccuracyRange: [0.85, 0.95], // 85-95% accuracy
    label: 'Hard',
    description: 'Chaser has more time and rarely makes mistakes'
  }
};

// Game constants
export const CASH_BUILDER_QUESTIONS = 10;     // Number of questions in Cash Builder
export const TIME_PER_CORRECT = 5;            // Seconds added per correct answer
export const MAX_CONTESTANT_TIME = 60;        // Cap to prevent runaway accumulation
export const TIME_BONUS_AMOUNT = 5;           // Seconds added for catch-up mechanic
export const CHASER_THINKING_DELAY = 1000;    // 1 second thinking delay (faster than Chase)

// Helper function to calculate chaser starting time
export function calculateChaserTime(contestantTime: number, difficulty: BeatTheChaserDifficulty): number {
  const config = BEAT_THE_CHASER_DIFFICULTY[difficulty];
  return Math.floor(contestantTime * config.timeRatio);
}

// Helper function to get random AI accuracy within range
export function getChaserAccuracy(difficulty: BeatTheChaserDifficulty): number {
  const config = BEAT_THE_CHASER_DIFFICULTY[difficulty];
  const [min, max] = config.aiAccuracyRange;
  return min + Math.random() * (max - min);
}
```
  </action>
  <verify>File exists and exports are accessible: `cd "/Users/ricky/Documents/App_Projects/Education Apps/DEV - PiPi" && npx tsc --noEmit`</verify>
  <done>Difficulty config with time ratios (0.8/1.0/1.2), AI accuracy ranges, and game constants created</done>
</task>

<task type="auto">
  <name>Task 3: Create setup modal component</name>
  <files>components/games/beat-the-chaser/SetupModal.tsx</files>
  <action>
Create SetupModal component at components/games/beat-the-chaser/SetupModal.tsx following TheChaseGame's setup modal pattern but simpler (no offers to configure):

```typescript
import React, { useState } from 'react';
import { BEAT_THE_CHASER_DIFFICULTY, BeatTheChaserDifficulty } from './beatTheChaserConfig';

interface SetupModalProps {
  onStart: (difficulty: BeatTheChaserDifficulty, isAIControlled: boolean) => void;
  onCancel: () => void;
}

const SetupModal: React.FC<SetupModalProps> = ({ onStart, onCancel }) => {
  const [selectedDifficulty, setSelectedDifficulty] = useState<BeatTheChaserDifficulty>('medium');
  const [isAIControlled, setIsAIControlled] = useState(true);

  return (
    <div className="fixed inset-0 bg-black/80 flex items-center justify-center z-50 font-poppins">
      <div className="bg-slate-800 p-8 rounded-2xl max-w-2xl w-full mx-4 border-2 border-slate-600">
        <h2 className="text-3xl font-black text-amber-400 mb-6 text-center">
          Beat the Chaser Setup
        </h2>

        {/* Difficulty Selection */}
        <div className="mb-6">
          <h3 className="text-lg font-bold text-white mb-3">Select Difficulty</h3>
          <div className="grid grid-cols-3 gap-4">
            {(Object.keys(BEAT_THE_CHASER_DIFFICULTY) as BeatTheChaserDifficulty[]).map((diff) => {
              const config = BEAT_THE_CHASER_DIFFICULTY[diff];
              const isSelected = selectedDifficulty === diff;

              return (
                <button
                  key={diff}
                  onClick={() => setSelectedDifficulty(diff)}
                  className={`p-4 rounded-xl border-2 transition-all text-left ${
                    isSelected
                      ? 'border-amber-400 bg-amber-500/20'
                      : 'border-slate-600 bg-slate-700/50 hover:border-slate-500'
                  }`}
                >
                  <div className="font-bold text-white text-lg mb-1">{config.label}</div>
                  <div className="text-sm text-slate-400">{config.description}</div>
                  <div className="text-xs text-slate-500 mt-2">
                    Chaser: {Math.round(config.timeRatio * 100)}% time
                  </div>
                </button>
              );
            })}
          </div>
        </div>

        {/* AI Control Toggle */}
        <div className="mb-8">
          <h3 className="text-lg font-bold text-white mb-3">Chaser Control</h3>
          <div className="flex gap-4">
            <button
              onClick={() => setIsAIControlled(true)}
              className={`flex-1 p-4 rounded-xl border-2 transition-all ${
                isAIControlled
                  ? 'border-amber-400 bg-amber-500/20'
                  : 'border-slate-600 bg-slate-700/50 hover:border-slate-500'
              }`}
            >
              <div className="font-bold text-white">AI-Controlled</div>
              <div className="text-sm text-slate-400">Chaser answers automatically</div>
            </button>
            <button
              onClick={() => setIsAIControlled(false)}
              className={`flex-1 p-4 rounded-xl border-2 transition-all ${
                !isAIControlled
                  ? 'border-amber-400 bg-amber-500/20'
                  : 'border-slate-600 bg-slate-700/50 hover:border-slate-500'
              }`}
            >
              <div className="font-bold text-white">Manual Control</div>
              <div className="text-sm text-slate-400">Teacher controls chaser</div>
            </button>
          </div>
        </div>

        {/* Action Buttons */}
        <div className="flex gap-4">
          <button
            onClick={onCancel}
            className="flex-1 py-3 px-6 bg-slate-700 hover:bg-slate-600 text-white font-bold rounded-xl transition-colors"
          >
            Cancel
          </button>
          <button
            onClick={() => onStart(selectedDifficulty, isAIControlled)}
            className="flex-1 py-3 px-6 bg-amber-500 hover:bg-amber-400 text-amber-950 font-bold rounded-xl transition-colors"
          >
            Start Game
          </button>
        </div>
      </div>
    </div>
  );
};

export default SetupModal;
```

Style notes:
- Match TheChase setup modal visual style
- Clear difficulty descriptions showing time ratio impact
- AI toggle defaults to AI-Controlled
  </action>
  <verify>Component renders without errors, TypeScript compiles: `cd "/Users/ricky/Documents/App_Projects/Education Apps/DEV - PiPi" && npx tsc --noEmit`</verify>
  <done>Setup modal with difficulty selection (Easy/Medium/Hard) and AI control toggle created</done>
</task>

</tasks>

<verification>
1. TypeScript compiles without errors
2. BeatTheChaserState type includes phase, difficulty, battle state fields
3. Difficulty config exports BEAT_THE_CHASER_DIFFICULTY with time ratios and accuracy ranges
4. SetupModal component exists and exports default
</verification>

<success_criteria>
- BeatTheChaserState extended with all necessary game state fields
- Difficulty config defines Easy (80% time, 50-60% accuracy), Medium (100%, 70-80%), Hard (120%, 85-95%)
- Setup modal allows difficulty and AI control selection
- All TypeScript compiles without errors
</success_criteria>

<output>
After completion, create `.planning/phases/24-beat-the-chaser/24-01-SUMMARY.md`
</output>
