# Milestone v3.7: AI Resource Enhancement

**Status:** SHIPPED 2026-01-31
**Phases:** 42-47
**Total Plans:** 12

## Overview

Cue v3.7 enables teachers to enhance their existing worksheets and handouts with AI while maintaining original intent. Slide content speaks directly to students via prompt improvements, and a full resource enhancement pipeline supports PDF/image/Word upload, AI-powered differentiation, preview with trust UI, and print-ready export.

## Phases

### Phase 42: Student-Friendly Slide Generation

**Goal:** Slide content speaks directly to students in age-appropriate language.
**Depends on:** Phase 41
**Plans:** 2 plans

Plans:
- [x] 42-01: Foundation: shared prompt rules and gradeLevel wiring
- [x] 42-02: Integration: apply rules to both AI providers

**Requirements:** SLIDE-01, SLIDE-02, SLIDE-03

**Details:**
- Created `getStudentFriendlyRules(gradeLevel)` shared function
- Integrated into Gemini and Claude providers for all generation modes
- Applied to variant slides (elaborate, work-together, class-challenge)

---

### Phase 43: Types and File Upload

**Goal:** Teachers can upload existing resources (worksheets, handouts) in common formats for AI enhancement.
**Depends on:** Phase 42
**Plans:** 2 plans

Plans:
- [x] 43-01: Foundation: types, document processors, upload service
- [x] 43-02: UI: upload panel with drop zone, progress, preview

**Requirements:** UPLOAD-01, UPLOAD-02, UPLOAD-03, UPLOAD-04, UPLOAD-05

**Details:**
- Document processors for PDF (pdf.js), images (native), DOCX (mammoth.js)
- UploadPanel with drag-drop, browse button, progress indicator
- Thumbnail preview grid with file type badges and page count

---

### Phase 44: AI Document Analysis

**Goal:** AI understands uploaded documents before enhancement begins.
**Depends on:** Phase 43
**Plans:** 1 plan

Plans:
- [x] 44-01: Types, prompts, provider methods, and analysis service

**Requirements:** (Foundation for ENHANCE requirements - no direct mapping)

**Details:**
- DocumentAnalysis type with classification, elements, confidence
- Multimodal AI (Gemini structured output, Claude tool_choice)
- PDF page rendering at 1.5 scale for AI accuracy

---

### Phase 45: Enhancement with Lesson Context

**Goal:** AI enhances resources while preserving original content and aligning with lesson context.
**Depends on:** Phase 44
**Plans:** 3 plans

Plans:
- [x] 45-01: Types, prompts, and AIProviderInterface extension
- [x] 45-02: Provider implementations and enhancement service
- [x] 45-03: UI: EnhancementPanel with progress, cancel, and results

**Requirements:** ENHANCE-01, ENHANCE-02, ENHANCE-03, ENHANCE-04, ENHANCE-05, ENHANCE-06

**Details:**
- Enhancement prompts with CRITICAL preservation rules
- buildSlideContextForEnhancement with 15-slide limit
- Three differentiation tabs (Simple/Standard/Detailed)
- Answer key generation with marking criteria
- AbortController for cancellation support

---

### Phase 46: Preview, Edit, and Trust UI

**Goal:** Teachers can see, understand, and approve AI changes before committing.
**Depends on:** Phase 45
**Plans:** 2 plans

Plans:
- [x] 46-01: Edit mode and inline editing with state management
- [x] 46-02: Diff view and per-element regeneration

**Requirements:** PREVIEW-01, PREVIEW-02, PREVIEW-03, PREVIEW-04

**Details:**
- EditState with useReducer for element modifications
- contenteditable="plaintext-only" for security
- react-diff-viewer-continued with word-level highlighting
- Per-element regenerate buttons with focused AI prompts
- Mutually exclusive diff/edit modes

---

### Phase 47: Export and Persistence

**Goal:** Enhanced resources produce print-ready output and persist across sessions.
**Depends on:** Phase 46
**Plans:** 2 plans

Plans:
- [x] 47-01: PDF export service and zip bundling with UI button
- [x] 47-02: CueFile v4 persistence with save/load integration

**Requirements:** EXPORT-01, EXPORT-02, EXPORT-03

**Details:**
- jsPDF text API for vector PDF output
- A4 portrait with 25mm left margin for binding
- JSZip bundles all PDFs in single download
- CueFile v4 with enhancedResources field
- SerializedEditState uses tuple arrays for Map serialization
- v3->v4 migration defaults empty array

---

## Milestone Summary

**Key Decisions:**
- Use multimodal AI (Gemini/Claude vision) for document analysis, not OCR
- Add mammoth.js for Word support (only new dependency)
- Preserve mode as default to prevent hallucination
- Trust UI (visual diff, edit capability) is critical for teacher adoption
- jsPDF text API for sharper PDF export than html2canvas rasterization

**Issues Resolved:**
- React 19 compatibility with react-diff-viewer-continued via --legacy-peer-deps
- PDF analysis page extraction during upload (stored in content.images)
- Browse button click propagation in UploadPanel

**Technical Debt:**
- Phase 45 missing formal VERIFICATION.md (all 3 SUMMARY.md files confirm completion)

---

*For current project status, see .planning/ROADMAP.md*
