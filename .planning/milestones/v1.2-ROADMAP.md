# Milestone v1.2: Permission Flow Fix

**Status:** SHIPPED 2026-01-18
**Phases:** 1-2
**Total Plans:** 5

## Overview

This milestone fixes the race condition in Window Management API permission detection and improves the permission UX. Phase 1 fixes the hook to distinguish "loading" from "unavailable", eliminating the race condition. Phase 2 updates the UI to communicate permission state clearly through button labels, toasts, and recovery guidance.

## Phases

### Phase 1: Permission State Loading

**Goal**: Permission state resolves definitively before any UI decisions are made
**Depends on**: Nothing (first phase)
**Requirements**: PERM-01
**Plans**: 1 plan

Plans:

- [x] 01-01-PLAN.md - Add isLoading state to hook and update consumer

**Success Criteria Achieved:**
1. Launch button shows "Checking displays..." during initial permission query
2. No permission-related UI appears until async check completes
3. PermissionExplainer only appears when state is definitively 'prompt'

### Phase 2: Permission UX

**Goal**: Teacher always knows the current auto-placement capability and can act on it
**Depends on**: Phase 1
**Requirements**: PERM-02, PERM-03, PERM-04, PERM-05, PERM-06
**Plans**: 4 plans

Plans:

- [x] 02-01-PLAN.md - Button labels + warning icon + launch toast
- [x] 02-02-PLAN.md - Inline permission request link (replaces PermissionExplainer popup)
- [x] 02-03-PLAN.md - Denied recovery UI with browser-specific modal
- [x] 02-04-PLAN.md - Human verification of all permission UX

**Success Criteria Achieved:**
1. Launch button label changes based on permission state ("Launch -> External Display" when granted)
2. Teacher can request permission from a visible, persistent UI element (inline link, not popup)
3. Toast appears after launch confirming where window opened (removed during human verification - blocked UI)
4. When permission was previously denied, teacher sees recovery guidance with browser-specific instructions

---

## Milestone Summary

**Key Decisions:**

- loading-state-pattern: isLoading starts true, becomes false only after permission query resolves (safe default prevents race condition)
- friendly-label: Use 'External Display' instead of raw device names like 'DELL U2718Q'
- warning-icon-style: Amber-400 subtle warning triangle for denied state, not text change
- inline-link-style: Subtle blue underlined text link for permission requests, not a button or popup
- removed-popup: PermissionExplainer component no longer used (file kept for cleanup later)
- browser-detection-order: Check Edg/ before Chrome/ (Edge UA includes 'Chrome')
- recovery-trigger: Amber-colored link for visibility on denied state
- toasts-removed: Placement toasts removed during human verification (blocked UI buttons)
- arc-browser-limitation: Arc opens popups as tabs, so auto-placement doesn't work in Arc (Chrome works)

**Issues Resolved:**

- Fixed permission detection race condition (isLoading gates all permission UI)
- Fixed confusing popup-based permission explainer (replaced with inline link)
- Fixed lack of recovery guidance when permission denied

**Issues Deferred:**

- Orphaned file cleanup: components/PermissionExplainer.tsx no longer imported

**Technical Debt Incurred:**

- PermissionExplainer.tsx exists but is unused (cleanup in future pass)

---

_For current project status, see .planning/ROADMAP.md_
